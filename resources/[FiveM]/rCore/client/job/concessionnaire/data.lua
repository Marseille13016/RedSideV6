local vehicle = {
    {
        nom = "Compacts",
        vehs = {
            {vehs= "blista", prix=7500},
            {vehs= "brioso", prix=4500},
            {vehs= "dilettante", prix=5500},
            {vehs= "issi2", prix=5000},
            {vehs= "issi3", prix=5500},
            {vehs= "panto", prix=3500},
            {vehs= "prairie", prix=9500},
            {vehs= "rhapsody", prix=8000},
        },
    },
    {
        nom = "Coupes",
        vehs = {
            {vehs= "cogcabrio", prix=9500},
            {vehs= "exemplar", prix=9300},
            {vehs= "f620", prix=11500},
            {vehs= "felon", prix=10000},
            {vehs= "felon2", prix=11000},
            {vehs= "jackal", prix=12000},
            {vehs= "oracle", prix=9500},
            {vehs= "oracle2", prix=10500},
            {vehs= "sentinel", prix=10000},
            {vehs= "sentinel2", prix=10500},
            {vehs= "windsor", prix=13000},
            {vehs= "windsor2", prix=14000},
            {vehs= "zion", prix=12000},
            {vehs= "zion2", prix=12500},
        },
    },
    {
        nom = "Muscle",
        vehs = {
            {vehs= "blade", prix=13500},
            {vehs= "buccaneer", prix=12500},
            {vehs= "buccaneer2", prix=13000},
            {vehs= "chino", prix=11500},
            {vehs= "chino2", prix=12000},
            {vehs= "clique", prix=14500},
            {vehs= "coquette3", prix=15000},
            {vehs= "deviant", prix=15000},
            {vehs= "dominator", prix=14000},
            {vehs= "dominator2", prix=14500},
            {vehs= "dominator3", prix=26000},
            {vehs= "dukes", prix=13500},
            {vehs= "faction", prix=12000},
            {vehs= "faction2", prix=13000},
            {vehs= "faction3", prix=13500},
            {vehs= "ellie", prix=13500},
            {vehs= "gauntlet", prix=13500},
            {vehs= "gauntlet2", prix=14000},
            {vehs= "hermes", prix=22000},
            {vehs= "hotknife", prix=14000},
            {vehs= "hustler", prix=18000},
            {vehs= "impaler", prix=14000},
            {vehs= "impaler2", prix=14500},
            {vehs= "impaler3", prix=15000},
            {vehs= "impaler4", prix=15500},
            {vehs= "imperator", prix=17000},
            {vehs= "imperator2", prix=17500},
            {vehs= "imperator3", prix=18000},
            {vehs= "moonbeam", prix=16000},
            {vehs= "moonbeam2", prix=17000},
            {vehs= "phoenix", prix=16000},
            {vehs= "picador", prix=15500},
            {vehs= "ratloader", prix=7800},
            {vehs= "ratloader2", prix=13500},
            {vehs= "ruiner", prix=18000},
            {vehs= "sabregt", prix=17500},
            {vehs= "sabregt2", prix=18000},
            {vehs= "slamvan", prix=17500},
            {vehs= "slamvan2", prix=18000},
            {vehs= "slamvan3", prix=18500},
            {vehs= "slamvan4", prix=19000},
            {vehs= "slamvan5", prix=19500},
            {vehs= "slamvan6", prix=20000},
            {vehs= "stalion", prix=18000},
            {vehs= "stalion2", prix=18500},
            {vehs= "tampa", prix=17500},
            {vehs= "tulip", prix=16500},
            {vehs= "vamos", prix=16000},
            {vehs= "vigero", prix=17500},
            {vehs= "virgo", prix=16500},
            {vehs= "virgo2", prix=17000},
            {vehs= "virgo3", prix=17500},
            {vehs= "voodoo", prix=19000},
            {vehs= "voodoo2", prix=20000},
            {vehs= "yosemite", prix=24000},
        },
    },
    {
        nom = "Off-Road",
        vehs = {
            {vehs= "bfinjection", prix=9500},
            {vehs= "bifta", prix=11500},
            {vehs= "blazer", prix=7500},
            {vehs= "blazer2", prix=8000},
            {vehs= "blazer3", prix=8500},
            {vehs= "blazer4", prix=9000},
            {vehs= "bodhi2", prix=14000},
            {vehs= "brawler", prix=19000},
            {vehs= "brutus", prix=17500},
            {vehs= "brutus2", prix=18000},
            {vehs= "brutus3", prix=18500},
            {vehs= "dloader", prix=14500},
            {vehs= "dubsta3", prix=25000},
            {vehs= "freecrawler", prix=21000},
            {vehs= "kalahari", prix=13500},
            {vehs= "kamacho", prix=23500},
            {vehs= "marshall", prix=35000},
            {vehs= "mesa3", prix=21000},
            {vehs= "rancherxl", prix=18500},
            {vehs= "rebel", prix=17500},
            {vehs= "rebel2", prix=18000},
            {vehs= "riata", prix=21000},
            {vehs= "sandking", prix=25000},
            {vehs= "sandking2", prix=26000},
            {vehs= "trophytruck", prix=27000},
            {vehs= "trophytruck2", prix=28000},
        },
    },
    {
        nom = "SUVs",
        vehs = {
            {vehs= "baller", prix=24000},
            {vehs= "baller2", prix=25000},
            {vehs= "baller3", prix=26000},
            {vehs= "baller4", prix=27500},
            {vehs= "bjxl", prix=21500},
            {vehs= "cavalcade", prix=20000},
            {vehs= "cavalcade2", prix=20500},
            {vehs= "contender", prix=36000},
            {vehs= "dubsta", prix=27800},
            {vehs= "dubsta2", prix=28000},
            {vehs= "fq2", prix=24500},
            {vehs= "granger", prix=26000},
            {vehs= "gresley", prix=21500},
            {vehs= "habanero", prix=19500},
            {vehs= "huntley", prix=15500},
            {vehs= "landstalker", prix=14500},
            {vehs= "mesa", prix=16500},
            {vehs= "patriot", prix=17800},
            {vehs= "radi", prix=14500},
            {vehs= "rocoto", prix=15000},
            {vehs= "seminole", prix=14000},
            {vehs= "serrano", prix=14500},
            {vehs= "toros", prix=45000},
            {vehs= "xls", prix=16500},
        },
    },
    {
        nom = "Sedans",
        vehs = {
            {vehs= "asea", prix=11500},
            {vehs= "asterope", prix=12000},
            {vehs= "cog55", prix=15000},
            {vehs= "cognoscenti", prix=15500},
            {vehs= "emperor", prix=13500},
            {vehs= "emperor2", prix=12000},
            {vehs= "fugitive", prix=11500},
            {vehs= "glendale", prix=12000},
            {vehs= "ingot", prix=13000},
            {vehs= "intruder", prix=13500},
            {vehs= "premier", prix=12500},
            {vehs= "primo", prix=12500},
            {vehs= "primo2", prix=15000},
            {vehs= "regina", prix=11500},
            {vehs= "romero", prix=18500},
            {vehs= "stafford", prix=21000},
            {vehs= "stanier", prix=12500},
            {vehs= "stratum", prix=13500},
            {vehs= "stretch", prix=29000},
            {vehs= "superd", prix=23000},
            {vehs= "surge", prix=13500},
            {vehs= "tailgater", prix=12500},
            {vehs= "warrener", prix=11500},
            {vehs= "washington", prix=12500},
        },
    },
    {
        nom = "Sports",
        vehs = {
            {vehs= "alpha", prix=34000},
            {vehs= "banshee", prix=36000},
            {vehs= "bestiagts", prix=35500},
            {vehs= "blista2", prix=24000},
            {vehs= "blista3", prix=24500},
            {vehs= "buffalo", prix=27000},
            {vehs= "buffalo2", prix=27500},
            {vehs= "buffalo3", prix=28000},
            {vehs= "carbonizzare", prix=38500},
            {vehs= "comet2", prix=48500},
            {vehs= "comet3", prix=49000},
            {vehs= "comet4", prix=49500},
            {vehs= "comet5", prix=50000},
            {vehs= "coquette", prix=41000},
            {vehs= "deveste", prix=128000},
            {vehs= "elegy", prix=38500},
            {vehs= "elegy2", prix=44000},
            {vehs= "feltzer2", prix=41500},
            {vehs= "flashgt", prix=43000},
            {vehs= "furoregt", prix=41500},
            {vehs= "fusilade", prix=41000},
            {vehs= "futo", prix=37500},
            {vehs= "gb200", prix=38500},
            {vehs= "hotring", prix=37000},
            {vehs= "italigto", prix=48500},
            {vehs= "jester", prix=45000},
            {vehs= "jester2", prix=46000},
            {vehs= "jester3", prix=47000},
            {vehs= "khamelion", prix=43500},
            {vehs= "kuruma", prix=42500},
            {vehs= "lynx", prix=43500},
            {vehs= "massacro", prix=44500},
            {vehs= "massacro2", prix=45000},
            {vehs= "neon", prix=43500},
            {vehs= "ninef", prix=42500},
            {vehs= "ninef2", prix=43500},
            {vehs= "omnis", prix=41000},
            {vehs= "pariah", prix=42500},
            {vehs= "penumbra", prix=39000},
            {vehs= "raiden", prix=41000},
            {vehs= "rapidgt", prix=41000},
            {vehs= "rapidgt2", prix=41500},
            {vehs= "raptor", prix=38500},
            {vehs= "revolter", prix=42000},
            {vehs= "ruston", prix=45000},
            {vehs= "schafter2", prix=41000},
            {vehs= "schafter3", prix=42000},
            {vehs= "schafter4", prix=43000},
            {vehs= "schlagen", prix=47000},
            {vehs= "schwarzer", prix=43000},
            {vehs= "sentinel3", prix=41500},
            {vehs= "seven70", prix=43500},
            {vehs= "specter", prix=42500},
            {vehs= "specter2", prix=43000},
            {vehs= "streiter", prix=44000},
            {vehs= "sultan", prix=32500},
            {vehs= "tampa2", prix=35000},
            {vehs= "tropos", prix=36000},
            {vehs= "verlierer2", prix=38000},

        },
    },
    {
        nom = "Sports Classic",
        vehs = {
            {vehs= "ardent", prix=65000},
            {vehs= "btype", prix=55000},
            {vehs= "btype2", prix=54000},
            {vehs= "btype3", prix=58000},
            {vehs= "casco", prix=47000},
            {vehs= "cheetah2", prix=51000},
            {vehs= "coquette2", prix=53000},
            {vehs= "fagaloa", prix=24000},
            {vehs= "feltzer3", prix=58000},
            {vehs= "gt500", prix=48000},
            {vehs= "infernus2", prix=64000},
            {vehs= "mamba", prix=44000},
            {vehs= "manana", prix=31000},
            {vehs= "michelli", prix=32000},
            {vehs= "monroe", prix=36000},
            {vehs= "peyote", prix=29000},
            {vehs= "pigalle", prix=29500},
            {vehs= "rapidgt3", prix=31000},
            {vehs= "retinue", prix=31200},
            {vehs= "savestra", prix=31000},
            {vehs= "stinger", prix=36000},
            {vehs= "stingergt", prix=38000},
            {vehs= "stromberg", prix=48000},
            {vehs= "swinger", prix=44000},
            {vehs= "torero", prix=49000},
            {vehs= "tornado", prix=41000},
            {vehs= "tornado2", prix=42000},
            {vehs= "tornado3", prix=43000},
            {vehs= "tornado4", prix=44000},
            {vehs= "tornado5", prix=45000},
            {vehs= "tornado6", prix=46000},
            {vehs= "turismo2", prix=55000},
            {vehs= "viseris", prix=56000},
            {vehs= "z190", prix=51000},
            {vehs= "ztype", prix=65000},
            {vehs= "cheburek", prix=34000},
        },
    },
    {
        nom = "Super",
        vehs = {
            {vehs= "adder", prix=525000},
            {vehs= "autarch", prix=550000},
            {vehs= "banshee2", prix=225000},
            {vehs= "bullet", prix=180500},
            {vehs= "cheetah", prix=235000},
            {vehs= "cyclone", prix=245000},
            {vehs= "entity2", prix=325000},
            {vehs= "entityxf", prix=320000},
            {vehs= "fmj", prix=321000},
            {vehs= "gp1", prix=324000},
            {vehs= "infernus", prix=265000},
            {vehs= "italigtb", prix=315000},
            {vehs= "italigtb2", prix=320000},
            {vehs= "le7b", prix=445000},
            {vehs= "nero", prix=365000},
            {vehs= "nero2", prix=370000},
            {vehs= "osiris", prix=445000},
            {vehs= "penetrator", prix=280000},
            {vehs= "pfister811", prix=315000},
            {vehs= "prototipo", prix=750000},
            {vehs= "reaper", prix=385000},
            {vehs= "sc1", prix=365000},
            {vehs= "sheava", prix=480000},
            {vehs= "sultanrs", prix=220000},
            {vehs= "t20", prix=465000},
            {vehs= "taipan", prix=432000},
            {vehs= "tempesta", prix=395000},
            {vehs= "tezeract", prix=650000},
            {vehs= "turismor", prix=550000},
            {vehs= "tyrant", prix=565000},
            {vehs= "tyrus", prix=480000},
            {vehs= "vacca", prix=435000},
            {vehs= "vagner", prix=650000},
            {vehs= "visione", prix=375000},
            {vehs= "voltic", prix=225000},
            {vehs= "xa21", prix=385000},
            {vehs= "zentorno", prix=375000},
        },
    },
    {
        nom = "Vans",
        vehs = {
            {vehs= "bison", prix=35000},
            {vehs= "bison2", prix=36000},
            {vehs= "bison3", prix=37000},
            {vehs= "burrito", prix=31000},
            {vehs= "burrito2", prix=32000},
            {vehs= "burrito3", prix=33000},
            {vehs= "burrito4", prix=34000},
            {vehs= "burrito5", prix=35000},
            {vehs= "gburrito", prix=36000},
            {vehs= "gburrito2", prix=37000},
            {vehs= "journey", prix=25000},
            {vehs= "minivan", prix=28000},
            {vehs= "minivan2", prix=32000},
            {vehs= "paradise", prix=28500},
            {vehs= "rumpo3", prix=36000},
            {vehs= "speedo", prix=24000},
            {vehs= "speedo4", prix=26000},
            {vehs= "surfer", prix=21000},
            {vehs= "surfer2", prix=23000},
            {vehs= "youga", prix=22000},
            {vehs= "youga2", prix=23000},

        },
    },
    {
        nom = "[VIP] - Gamme classique",
        vehs = {
            {vehs= "PANAMERA17TURBO", label = "Panamera Porsche", prix=32500},
            {vehs= "370Z", label = "Nissan 370z", prix=36500},
            {vehs= "A45", label = "Mercedes A45", prix=26000},
            {vehs= "audiq8", label = "Audi Q8", prix=41000},
            {vehs= "17m760i", label = "BMW 760i", prix=34500},
            {vehs= "c63", label = "c63", prix=28250},
            --{vehs= "rs3", label = "rs3", prix=23000},
            {vehs= "CHARGERF8", label = "chargerf8", prix=38500},
            {vehs= "CLS2015", label = "CLS 2015", prix=25500},
            {vehs= "demonhawk", label = "DemonHawk", prix=44000},
            {vehs= "pm19", label = "Porsche Maccan", prix=37000},
            {vehs= "S500W222", label = "Mercedew s500w", prix=24500},
            --{vehs= "RX7TUNABLE", label = "RX7", prix=23000},
            {vehs= "Templar", label = "Templar", prix=12500},
            {vehs= "X6M", label = "BMW x6m", prix=45000},
        },
    },
    {
        nom = "[VIP] - Gamme supérieur",
        vehs = {
            {vehs= "2020RS6", label = "RS6 2020", prix=48000},
            {vehs= "MLBRABUS", label = "Mercedes Brabus", prix=44000},
            {vehs= "17bcs", label = "Bentley", prix=59000},
            {vehs= "911TURBOS", label = "Porshe 911 Turbo", prix=65000},
            {vehs= "GTRC", label = "Mercedes GTRC", prix=64000},
            {vehs= "APERTA", label = "Ferrari Aperta", prix=170000},
            {vehs= "db11", label = "Aston Martin", prix=62000},
            {vehs= "aventadors", label = "Lamborghini Aventadors", prix=145000},
            {vehs= "rmodi8mlb", label = "bmw i8", prix=84500},
            {vehs= "divo", label = "Bughatti Divo", prix=450000},
            {vehs= "r8prior", label = "Audi r8", prix=75000},
            {vehs= "F812", label = "Ferrari F812", prix=125000},
            {vehs= "URUS", label = "Lamborghini Urus", prix=95000},
            {vehs= "zentenario", label = "Lamborghini Zentanario", prix=115000},
        },
    },
}

local rotate = true
local open = false
local local_veh = {
    props = nil,
    entity = nil,
    model = nil,
    price = nil,
}
local cam = nil

RMenu.Add('core', 'concess_previsu', RageUI.CreateMenu("", "~b~pré visualisation", nil, nil, "root_cause", "shopui_title_legendarymotorsport"))
RMenu:Get('core', "concess_previsu").Closed = function()
    open = false
    local_veh.model = nil
    DeleteVehicle(local_veh.entity)
    RenderScriptCams(0, 0, 0, 0, 0)
end

Citizen.CreateThread(function()
    for k,v in pairs(vehicle) do
        RMenu.Add('core', v.nom.."5", RageUI.CreateSubMenu(RMenu:Get('core', 'concess_previsu'), "", "~b~concess", nil, nil, "root_cause", "shopui_title_legendarymotorsport"))
        RMenu:Get('core', v.nom.."5").EnableMouse = false
        RMenu:Get('core', v.nom.."5").Closed = function()
            local_veh.model = nil
            DeleteVehicle(local_veh.entity)
            RenderScriptCams(0, 0, 0, 0, 0)
        end
    end
end)


rUtils.RegisterActionZone({
    pos = vector3(-74.6332, 70.3759, 71.70666),
    action = function()
        OpenPreVisu()
    end,
})

    
function OpenPreVisu()
    cam = CreateCam("DEFAULT_SCRIPTED_CAMERA", 0)
    
    SetCamActive(cam, 1)
    SetCamCoord(cam, -68.6133, 76.11544, 72.8146)
    SetCamFov(cam, 50.0)
    PointCamAtCoord(cam, -75.81746, 74.9984, 71.91198)

    if open then return end
    RageUI.Visible(RMenu:Get('core', 'concess_previsu'), not RageUI.Visible(RMenu:Get('core', 'concess_previsu')))
    open = true
    Citizen.CreateThread(function()
        while open do
            Wait(1)
            RageUI.IsVisible(RMenu:Get('core', 'concess_previsu'), true, true, false, function()
            
                for k,v in pairs(vehicle) do
                    RageUI.ButtonWithStyle(v.nom, nil, { RightLabel = "→→→" }, true, function(_,_,s)
                    end, RMenu:Get('core', v.nom.."5"))
                end
            
            end, function()
            end)


            for k,v in pairs(vehicle) do
                RageUI.IsVisible(RMenu:Get('core', v.nom.."5"), true, true, false, function()
                    for _,i in pairs(v.vehs) do
                        local displaytext = GetDisplayNameFromVehicleModel(i.vehs)
                        local veh_name
                        if i.label == nil then
                            veh_name = GetLabelText(displaytext)
                        else
                            veh_name = i.label
                        end
                        RageUI.Button(veh_name, nil, true, function(Hovered, Active, Selected)
                            if Active then
                                if local_veh.model ~= GetHashKey(i.vehs) then

                                    DeleteVehicle(local_veh.entity)
                                    CreateLocalVeh(GetHashKey(i.vehs))
                                end
                            end
                        end)


                    end
                end, function()
                end)
            end
        end
    end)
end

function LoadConcessData()

    rUtils.RegisterActionZone({
        pos = vector3(-83.3046, 80.85424, 71.5157),
        action = function()
            OpenSellMenu()
        end,
    })

    RMenu.Add('core', 'concess_vente_veh', RageUI.CreateMenu("", "~b~Vendre son véhicule", nil, nil, "root_cause", "shopui_title_legendarymotorsport"))
    RMenu:Get('core', "concess_vente_veh").Closed = function()
        open = false
    end

    local vehSell_price = 0
    function GetVehPrice(entity)
        local name = string.lower(GetDisplayNameFromVehicleModel(GetEntityModel(entity)))
        for k,v in pairs(vehicle) do
            for _,i in pairs(v.vehs) do
                if i.vehs == name then
                    vehSell_price = i.prix / 2
                end
            end
        end
    end

    function OpenSellMenu()
        if not IsPedInAnyVehicle(pPed, false) then return end
        vehSell_price = 0
        if open then return end
        GetVehPrice(GetVehiclePedIsIn(pPed, false))
        RageUI.Visible(RMenu:Get('core', 'concess_vente_veh'), not RageUI.Visible(RMenu:Get('core', 'concess_vente_veh')))
        open = true
        Citizen.CreateThread(function()
            while open do
                Wait(1)
                RageUI.IsVisible(RMenu:Get('core', 'concess_vente_veh'), true, true, false, function()
                    if IsPedInAnyVehicle(pPed, false) then
                        RageUI.ButtonWithStyle("Vendre le véhicule", nil, { RightLabel = "~g~"..vehSell_price.."$"  }, true, function(Hovered, Active, Selected)
                            if Selected then

                                TriggerServerEvent(events.DelVehFromGarage, token, GetVehicleNumberPlateText(GetVehiclePedIsIn(pPed, false)), vehSell_price, string.lower(GetDisplayNameFromVehicleModel(GetEntityModel(GetVehiclePedIsIn(pPed, false)))), VehToNet(GetVehiclePedIsIn(pPed, false)))
                            end
                        end) 
                    end
                
                end, function()
                end)
            end
        end)

    end

    

    rUtils.RegisterActionZone({
        pos = vector3(-53.04, 73.4, 71.9),
        action = function()
            OpenConcessmenu()
        end,
    })


    local vehs_avalaible = {}
    
    local global_veh = {
        props = nil,
        entity = nil,
    }
    
    local NearPlayer = {}
    
    
    
    RMenu.Add('core', 'concess', RageUI.CreateMenu("", "~b~achat de véhicule", nil, nil, "root_cause", "shopui_title_legendarymotorsport"))
    RMenu:Get('core', "concess").Closed = function()
        DeleteVehicle(local_veh.entity)
        local_veh.model = nil
        open = false
        rotate = false
        RenderScriptCams(0, 0, 0, 0, 0)
        SetCamActive(cam, false)
    end
    
    
    
    Citizen.CreateThread(function()
        for k,v in pairs(vehicle) do
            RMenu.Add('core', v.nom, RageUI.CreateSubMenu(RMenu:Get('core', 'concess'), "", "~b~concess "..v.nom, nil, nil, "root_cause", "shopui_title_legendarymotorsport"))
            RMenu:Get('core', v.nom).EnableMouse = false
            RMenu:Get('core', v.nom).Closed = function()
                local_veh.model = nil
                DeleteVehicle(local_veh.entity)
                RenderScriptCams(0, 0, 0, 0, 0)
            end
        end
    
        RMenu.Add('core', "avalaible", RageUI.CreateSubMenu(RMenu:Get('core', 'concess'), "", "~b~Véhicule disponible à la vente", nil, nil, "root_cause", "shopui_title_legendarymotorsport"))
        RMenu:Get('core', "avalaible").EnableMouse = false
        RMenu:Get('core', "avalaible").Closed = function()
            --DeleteVehicle(local_veh.entity)
            local_veh.model = nil
            RenderScriptCams(0, 0, 0, 0, 0)
        end
    
        RMenu.Add('core', "infoVeh", RageUI.CreateSubMenu(RMenu:Get('core', 'avalaible'), "", "~b~information du véhicule", nil, nil, "root_cause", "shopui_title_legendarymotorsport"))
        RMenu:Get('core', "infoVeh").EnableMouse = false
        RMenu:Get('core', "infoVeh").Closed = function()
            local_veh.model = nil
        end
    end)
     
    

    
    
    function OpenConcessmenu()
        cam = CreateCam("DEFAULT_SCRIPTED_CAMERA", 0)
        
        SetCamActive(cam, 1)
        SetCamCoord(cam, -68.6133, 76.11544, 72.8146)
        SetCamFov(cam, 50.0)
        PointCamAtCoord(cam, -75.81746, 74.9984, 71.91198)

        if open then return end
        RageUI.Visible(RMenu:Get('core', 'concess'), not RageUI.Visible(RMenu:Get('core', 'concess')))
        open = true
        Citizen.CreateThread(function()
            while open do
                Wait(1)
                RageUI.IsVisible(RMenu:Get('core', 'concess'), true, true, false, function()
                
                    RageUI.ButtonWithStyle("Donner une facture", nil, { RightBadge = RageUI.BadgeStyle.Cash }, true, function(Hovered, Active, Selected)
                        if Selected then
                            OpenBillCreation()
                        end
                    end) 

                
                    RageUI.ButtonWithStyle("Véhicule prêt à la vente.", nil, { RightLabel = "→→→" }, true, function()
                    end, RMenu:Get('core', "avalaible"))
                
                    for k,v in pairs(vehicle) do
                        RageUI.ButtonWithStyle(v.nom, nil, { RightLabel = "→→→" }, true, function(_,_,s)
                            
                        end, RMenu:Get('core', v.nom))
                    end
                
                end, function()
                end)
            
                RageUI.IsVisible(RMenu:Get('core', "avalaible"), true, true, false, function()
                    for _,v in pairs(vehs_avalaible) do
                        local displaytext = GetDisplayNameFromVehicleModel(v.prop.model)
                        local veh_name
                        local VipVeh = false
                        if v.label == nil then
                            veh_name = GetLabelText(displaytext)
                        else
                            veh_name = v.label
                            VipVeh = true
                        end
                        local_veh.vip = v.vip
                    
                        RageUI.ButtonWithStyle(veh_name, "", {}, true, function(Hovered, Active, Selected)
                            if Active then
                                if local_veh.model ~= v.prop.model then
                                    DeleteVehicle(local_veh.entity)
                                    CreateLocalVeh(v.prop.model, v.prop, veh_name, VipVeh)
                                end
                            end
                            if Selected then
                                RenderScriptCams(0, 0, 0, 0, 0)
                                DeleteVehicle(local_veh.entity)
                                GetNearPlayers()
                                local_veh.price = v.price
                                TriggerServerEvent(events.GetSocInfo, token, pJob)
                            end
                        end, RMenu:Get('core', "infoVeh"))
                    end
                end, function()
                end)
            
                RageUI.IsVisible(RMenu:Get('core', "infoVeh"), true, true, false, function()
                    local displaytext = GetDisplayNameFromVehicleModel(local_veh.model)
                    local veh_name
                    local vip = false
                    if local_veh.name == nil then
                        veh_name = GetLabelText(displaytext)
                    else
                        veh_name = local_veh.name
                        vip = true
                    end
                    RageUI.ButtonWithStyle("Nom du véhicule: "..veh_name, "", {}, true, function(Hovered, Active, Selected)
                    end)
                    RageUI.ButtonWithStyle("Plaque: ~b~["..local_veh.props.plate.."]", "", {}, true, function(Hovered, Active, Selected)
                    end)
                    for k,v in pairs(NearPlayer) do
                        local pPed = GetPlayerPed(v)
                        local pCoords = GetEntityCoords(pPed)
                        RageUI.ButtonWithStyle("Attribuer le véhicule à: "..GetPlayerName(v), "", {}, true, function(Hovered, Active, Selected)
                            if Active then
                                DrawMarker(20, pCoords.x, pCoords.y, pCoords.z+1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.3, 0.3, 0.3, 255, 255, 255, 170, 0, 1, 2, 0, nil, nil, 0)
                            end
                            if Selected then
                                if local_veh.price <= pSocietyTable.money then
                                    local id = GetPlayerServerId(v)
                                    local props = local_veh.props
                                    local props_final, plate = CreateVeh(props)
                                    TriggerServerEvent(events.AddVeh, token, id, displaytext, plate, props_final, local_veh.vip)
                                    for n,i in pairs(vehs_avalaible) do
                                        if local_veh.props.plate == i.prop.plate then
                                            table.remove(vehs_avalaible, n)
                                        end
                                    end
                                    DeleteVehicle(local_veh.entity)
                                    pSocietyTable.money = pSocietyTable.money - local_veh.price
                                    TriggerServerEvent(events.RmvSocMoney, token, pJob, local_veh.price)
                                else
                                    rUtils.ImportantNotif("La société n'a pas assez d'argent.")
                                end
                            end
                        end)
                    end
                end, function()
                end)
            
                for k,v in pairs(vehicle) do
                    RageUI.IsVisible(RMenu:Get('core', v.nom), true, true, false, function()
                        for _,i in pairs(v.vehs) do
                            local displaytext = GetDisplayNameFromVehicleModel(i.vehs)
                            local veh_name
                            if i.label == nil then
                                veh_name = GetLabelText(displaytext)
                            else
                                veh_name = i.label
                            end
                            RageUI.ButtonWithStyle(veh_name, "", { RightLabel = "~g~"..GroupDigits(i.prix).."$" }, true, function(Hovered, Active, Selected)
                                if Active then
                                    if local_veh.model ~= GetHashKey(i.vehs) then

                                        DeleteVehicle(local_veh.entity)
                                        CreateLocalVeh(GetHashKey(i.vehs))
                                    end
                                end
                                if (Selected) then
                                    local props = rUtils.GetVehicleProperties(local_veh.entity)
                                    local vip = IsVehVIP(i.vehs)
                                    table.insert(vehs_avalaible, {prop = props, price = i.prix, label = i.label, vip = vip})
                                    rUtils.Notif("Véhicule '"..veh_name.."' ajouté à la liste.\nPrix d'achats: ~g~"..i.prix)
                                end
                            end)
                        end
                    end, function()
                    end)
                end
            end
        end)
    end


    function IsVehVIP(name)
        local vip = false
        for k,v in pairs(vehicle[11].vehs) do
            if name == v.vehs then
                vip = true
                break
            end
        end
        for k,v in pairs(vehicle[12].vehs) do
            if name == v.vehs then
                vip = true
                break
            end
        end
        return vip
    end
    
    
    function GetNearPlayers()
        NearPlayer = {}
        local players = GetActivePlayers()
        local pPed = GetPlayerPed(-1)
        local pCoords = GetEntityCoords(pPed)
        for k,v in pairs(players) do
            local oCoords = GetEntityCoords(GetPlayerPed(v))
            local dst = GetDistanceBetweenCoords(pCoords, oCoords, true)
            if dst <= 15.0 then
                table.insert(NearPlayer, v)
            end
        end
    end
    
    
    
    function CreateVeh(props)
        RequestModel(props.model)
        while not HasModelLoaded(props.model) do Wait(1) end
    
        local veh = CreateVehicle_(props.model, -75.8364, 74.95964, 71.73424, 255.0, true, true)
        SetVehicleOnGroundProperly(veh)
        if props then
            rUtils.SetVehicleProperties(veh, props)
        end
        rUtils.Notif("Création de la plaque en cours ...")
        local plate = ""
        exports.rFramework:TriggerServerCallback(events.GenPlate, function(_plate)
            plate = _plate
            rUtils.Notif("Plaque ["..plate.."] crée!")
            SetVehicleNumberPlateText(veh, plate)
            
        end, token)    
        while plate == "" do Wait(1000) end
        return rUtils.GetVehicleProperties(veh), plate
    end
    
    
    
    GroupDigits = function(value)
        local left,num,right = string.match(value,'^([^%d]*%d)(%d*)(.-)$')
    
        return left..(num:reverse():gsub('(%d%d%d)','%1' .. " "):reverse())..right
    end


end


function CreateLocalVeh(model, props, name, vip)
    RenderScriptCams(1, 0, 0, 0, 0)
    RequestModel(model)
    while not HasModelLoaded(model) do Wait(1) end

    local veh = CreateVehicle_(model, -75.8364, 74.95964, 71.73424, 255.0, false, true)
    SetVehicleOnGroundProperly(veh)
    FreezeEntityPosition(veh, 1)
    if props then
        rUtils.SetVehicleProperties(veh, props)
    end
    --TaskWarpPedIntoVehicle(GetPlayerPed(-1), veh, -1)
    local_veh.entity = veh
    local_veh.model = model
    local_veh.props = rUtils.GetVehicleProperties(veh)
    if name ~= nil then local_veh.name = name end
    SetModelAsNoLongerNeeded(model)
    rotate = false
    Wait(50)
    RotateLocalVeh()
end

function RotateLocalVeh()
    rotate = true
    Citizen.CreateThread(function()
        while rotate do
            Wait(1)
            SetEntityHeading(local_veh.entity, GetEntityHeading(local_veh.entity) + 0.05)
            if IsControlPressed(1, 174) then
                SetEntityHeading(local_veh.entity, GetEntityHeading(local_veh.entity) - 0.55) 
            end
            if IsControlPressed(1, 175) then
                SetEntityHeading(local_veh.entity, GetEntityHeading(local_veh.entity) + 0.50) 
            end
        end
    end)
end